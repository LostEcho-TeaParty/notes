# MVC 模式

MVC 这个词从我开始进入信息系统学习的时候就开始听到了，但是这其中具体的实现细节还是要再想想的。

MVC 所联系的就是 GUI 程序，在浏览器中显示也好，以传统的 GUI 程序界面显示也好，MVC 是一种思想，能够将显示、运行逻辑、数据分割开，不让它们揉在一团，需要根据这种思想建立一个良好的执行框架。在给 GUI 程序增加功能、修改界面、更改逻辑时有一个稳定统一的模式，这其实又引申到设计模式上的问题了。

如果说我在大学时有什么需要后悔的事情，没有好好听讲面向对象这门课肯定可以算得上一件，当时老师带我们用设计模式将一个 Java 程序一点点重构，使之更加符合一个良好程序的要求。当时没有好好学习，实在是不应该。这其实是我现在一直头痛的事情，如何正确地使用软件的特性来实现良好的设计模式，使得程序能够更可信的走下去。

这篇笔记先不介绍 MVC 的概念了，我需要的是实现的框架，所以从我之前做过的信息系统软件上来体会。我大学时共做过两个信息系统，一个是内容管理系统，BS模式，Server 上是用 ThinkPHP 与 MySQL 进行搭建。另一个是订单管理系统，同样也是 BS 模式，Server 上是用 Node 与 MySQL 进行搭建。

## 过去的项目

需要注意的是，这里记录的过去的项目框架已经过时了，只要类似于后端渲染模板的方式就已经过时了，因为这样做其实没有真正的前后端分离。现在的框架会分离的更彻底，后端将只提供数据 API，以规定好的数据格式返回数据。而前端是怎样的我还不太清楚，没有继续学习了。过时技术的思想还是可以参考的。

### 内容管理系统
这个是 web 后端设计的大作业，当时还是什么都不知道的状态，接到这个作业后，非常的头痛。当时学习的后端编程语言是 PHP，问学长知道要去找 ThinkPHP 的框架，最后在 Youtube 上找到了一份 ThinkPHP 的 CMS 网站构建教程，现在知道是 singwa 的[前端到后台ThinkPHP开发整站](https://coding.imooc.com/class/chapter/48.html#Anchor)，教程的源代码可以在 [github](https://github.com/Mrguan12/singcms) 上找到。当时没日没夜地整了一个星期，最后还是把那个 CMS 搞出来了，后来也就没有后续了。

在学习这份课程的时候，第一次真正接触到 MVC 模式的实现，感觉非常的神奇。跟着这份教程做也确实有很大的收获。虽然这些东西可能已经过时了，或者说 PHP 都已经过时了，但是，对于软件结构的感受还是可以记录的。好在当时有写实验报告，所以恢复记忆不是那么的困难。

#### 系统介绍
这个内容管理系统需要管理的东西是上学期 web 前端设计的大作业，当时是仿照海事大学的首页网站山寨了一个。所以需要管理的就是这个山寨大学首页网站的文章、文章分类、轮播图等。

展示一下当时做的网站前台首页，虽然抄了很多的样式，偷了很多素材，但是网页最后实现的结果还是不错的，如下图：
<div align="center">
    <img src="images/cms前台首页.jpg" width=600px>
</div>

从右上角的`Login`按钮点击进入到登录界面，登录后就可以进入到网站后台，在后台中就可以对前台中的大部分内容进行管理。展示一下其中的轮播图设置页面，如下图：
<div align="center">
    <img src="images/cms后台示例.jpg" width=600px>
</div>

#### 框架结构
以上就是对这个系统的介绍，下面会介绍下这个框架的大体工作方式。由于工作方式为 BS 模式，程序是运行在服务器端的，浏览器通过 URL 访问服务器对应的服务，并通过 GET 或 POST 方式来传递必要数据，之后服务器端程序获取相关数据并进行处理，处理结束后将渲染好的页面，也即 html 文件，传递浏览器，浏览器负责将 html 文件进行解析并展示最后界面。

##### 入口
当程序在服务器上运行之后，会去监听 http 请求，根据请求的内容来进入到对应的入口。请求的 URL 格式类似`http://localhost/index.php?m=admin&c=image&a=index`，其中用 GET 方式向 `index.php`传递了三个参数，分别是`m(module)`、`c(controller)`、`a(action)`，所以上面的链接请求的是 admin module 下的 image controller 的 index action 的返回值，而该 action 返回的是就是渲染好的轮播图管理 html 文件，浏览器收到后就会显示页面了。

##### 渲染 C => V
thinkPHP 框架里面有渲染器，即使没有，PHP 也可以直接在 html 里建立特殊的标签来编写 PHP 语句，来让 PHP 解释器来运行。这里渲染的逻辑是将一些数据打包好放到渲染器中，渲染器之后会将这些数据填充到模版 html 文件的对应位置上，如何去填充会取决于渲染器的语法，或是直接用 PHP 语句来控制。

这其中最常见的就是将传递来的数据中的字符串填充到模板 html 文件中的标签（如 p 标签）的内容中，这样就可以控制显示的内容了。还有一种就是根据传递来的数据来设置一些标签的 active 属性，让一些特定的控件显示激活或是选中，如导航栏、多选框等。

由于可以直接控制 html 文件，所以对于 View 层的改动将非常灵活。但同样因为这个原因，对于表格数据、树状结构数据，渲染器的编写就会非常烦琐。

##### 操作 V => C
在页面上，会有很多的控件提供给用户操作，但一般来说，这些控件在 form 标签下，并且有一个提交按钮，将那些控件的值以 POST 或 GET 方式传递到服务器。
在这个系统中的实现方式是 jquery 的 ajax 请求。当点击提交按钮后，会运行对应的 js 代码，这些代码是在前端执行的，主要的任务就是先获取指定 form 标签下的数据，再将这些数据传递给特定的链接来让服务器处理。

如在轮播图修改页面下点击了“确认修改”按钮，就会将修改好的数据打包以 POST 方式传递到`/index.php?m=admin&c=image&a=add`地址，服务器接收到后就会让 admin module 下的 image controller 的 add action 来处理这些数据。

还有些按钮就很简单了，只是跳转到对应的页面，通过定位到新的 URL 来实现的。

##### 数据持久化 C <=> M
在这个系统中有使用数据库来存储数据，thinkPHP 有提供一些抽象来让我非常方便的操作数据库。首先要编写好 `xxModel.class.php`，在该类中提供需要使用数据库的方法，如`getImages($data = array())`、`getImageById($id)`，在这些方法的实现中具体操作数据库，不将数据库具体操作方法暴露出来，在 Controller 的 action 中，可以使用上面提到的方法。

### 订单管理系统

## 在 java swing 中的使用
写这篇文档的目的就是想要去探索一下在 java swing 中实现 MVC 的方法。在桌面 GUI 上只有 swing 用的稍稍多一点，写过几个小的作业，但是每次使用的时候，都会发现很难利用好 MVC 模式，action 与 页面总是难以分开，数据不知道在类之间传递。总之，每次用 swing 写的小软件都让我感觉很不好。
但为什么还要使用 swing、使用 java 来写 GUI 呢？因为 java 的跨平台性我真的是太喜欢了，因为我喜欢使用不同的操作系统，当我发现一些 java 软件可以毫无差别的运行在各个系统上时，我感觉到非常的方便。并且我慢慢发现我喜欢的一些软件同样是用 java swing 编写的，我又再次心动了。我想再次把 swing 用起来，那我就需要解决软件框架的问题，我需要把软件开发的各个功能以可重复的流程进行下去，这样我才能开心的用下去。

在描写工作模式之前，当然还是再回顾一下 swing 的结构，参考的是 [A Swing Architecture Overview](https://td4rqw.blu.livefilestore.com/y1mhJLM6NoC4uepo74L-qQPJyc2DE61FqackhuLH4HBQDd8BhzbvC_CsZlsFlXTL5OoD7RYQ6ESMQJgJS1D1yt_Hinz7xJ16QGSdlnDTbDbv-kGTxLEDiVkeDejnNmjEtiij32H2-asBm9Kam-2q5iv4A/Swing%20Architecture%20Overview.mht)，这篇文档在被迁移到 oracle 后就没有图片了，所以还是看原版的备份吧。